#!/bin/bash -xe

exec 2>&1

SERVERMODE={{cfg.server.mode}}

if [ "$SERVERMODE" = true ] ; then
  exec consul agent {{~#if cfg.website}} -ui {{~/if}} \
          {{#eachAlive svc.members as |member| ~}}
              -retry-join {{member.sys.ip}} \
          {{/eachAlive ~}}
          -server -bootstrap-expect {{cfg.bootstrap.expect}} \
          -config-file={{pkg.svc_config_path}}/basic_config.json
else
  exec consul agent -dev
fi
