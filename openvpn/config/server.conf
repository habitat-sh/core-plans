###################################################
# This file was generated by Habitat.
#
# For tunable settings see `default.toml`
#   in the core/openvpn package
###################################################
{{~#unless cfg.server}}
client
{{/unless}}
port {{cfg.port}}
proto {{cfg.proto}}
dev {{cfg.dev}}
topology {{cfg.topology}}
verb {{cfg.verb}}
user {{cfg.user}}
group {{cfg.group}}
cipher {{cfg.cipher}}

{{~#if cfg.auth}}
auth {{cfg.auth}}
{{~/if~}}

{{~#if cfg.local}}
local {{cfg.local}}
{{~/if~}}

{{~#if cfg.dev-node}}
dev-node {{cfg.dev-node}}
{{~/if~}}

{{!!! Server Only Settings !!!~}}
{{~#if cfg.server}}
server {{cfg.server}}
max-clients {{cfg.max-clients}}
  {{~#if cfg.client-config-dir}}
client-config-dir {{cfg.client-config-dir}}
  {{else}}
client-config-dir {{pkg.svc_data_path}}/ccd
  {{~/if}}
  {{~#each cfg.route}}
route {{this}}
  {{~/each}}
  {{~#if cfg.ifconfig-pool-persist}}
    {{~#if cfg.ifconfig-pool-persist-file}}
ifconfig-pool-persist {{cfg.ifconfig-pool-persist-file}}
    {{else}}
ifconfig-pool-persist {{pkg.svc_data_path}}/ipp.txt
    {{~/if}}
  {{~/if}}
  {{~#if cfg.status}}
    {{~#if cfg.status-file}}
status {{cfg.status-file}}
    {{else}}
status {{pkg.svc_data_path}}/openvpn-status.log
    {{~/if}}
  {{~/if}}
  {{~#if cfg.server-bridge}}
server-bridge {{cfg.server-bridge}}
  {{~/if}}
  {{~#each cfg.push}}
push "{{this}}"
  {{~/each}}
  {{~#if cfg.learn-address}}
learn-address {{cfg.learn-address}}
  {{~/if}}
  {{~#if cfg.client-to-client}}
client-to-client
  {{~/if}}
  {{~#if cfg.duplicate-cn}}
duplicate-cn
  {{~/if}}
  {{~#if cfg.explicit-exit-notify}}
explicit-exit-notify 1
  {{/if}}
keepalive {{cfg.keepalive}}
{{~/if~}}
{{!!! End Server Settings !!!~}}


{{!!! Compression Options !!!~}}
{{~#if cfg.compress}}
compress {{cfg.compress}}
  {{~#if cfg.server}}
push "compress {{cfg.compress}}"
  {{~/if}}
{{~/if}}
{{~#if cfg.comp-lzo}}
comp-lzo
{{~/if~}}

{{~#if cfg.persist-key}}
persist-key
{{~/if}}
{{~#if cfg.persist-tun}}
persist-tun
{{~/if~}}

{{!!! Logging !!!~}}
{{~#unless cfg.log_to_syslog}}
  {{~#if cfg.log-file}}
log {{cfg.log-file}}
  {{~/if}}
  {{~#if cfg.log-append}}
    {{~#unless cfg.log-file}}
log-append {{cfg.log-append-file}}
    {{~/unless}}
  {{~/if}}
{{~/unless~}}
{{!!! End Logging Section !!!~}}

{{~#if cfg.mute}}
mute {{cfg.mute}}
{{/if~}}

{{!!! SSL CA !!!~}}
{{~#if cfg.ca-file}}
ca {{cfg.ca-file}}
{{~/if}}
{{~#if cfg.ca}}
<ca>
{{cfg.ca~}}
</ca>
{{~/if~}}

{{!!! SSL Cert !!!~}}
{{~#if cfg.cert-file}}
cert {{cfg.cert-file}}
{{~/if}}
{{~#if cfg.cert}}
<cert>
{{cfg.cert~}}
</cert>
{{~/if~}}

{{!!! SSL Key !!!~}}
{{~#if cfg.key-file}}
key {{cfg.key-file}}
{{~/if~}}
{{~#if cfg.key}}
<key>
{{cfg.key~}}
</key>
{{~/if~}}

{{!!! SSL DH !!!~}}
{{~#if cfg.dh-file}}
dh {{cfg.dh-file}}
{{~/if~}}
{{~#if cfg.dh}}
<dh>
{{cfg.dh~}}
</dh>
{{~/if~}}

{{~#if cfg.tls-auth}}
  {{~#if cfg.server}}
key-direction 0
  {{~else}}
key-direction 1
  {{/if~}}
  {{~#if cfg.tls-auth-file}}
tls-auth {{cfg.tls-auth}}
  {{else}}
<tls-auth>
{{cfg.tls-auth-cert~}}
</tls-auth>
  {{/if~}}
{{~/if~}}
{{!!! END SSL Settings !!!~}}
